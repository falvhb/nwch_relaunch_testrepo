const Promise = require('es6-promise').Promise;

/**
 * Load an external JS file and attach in the beginning of
 * the <head> element
 *
 * @param  {String}    url    The absoulte or relative URL of the JS file
 *
 * @return  {Promise}  Promise which is resolved when loaded or rejected when it fails
 */
export default function(url) {

  return new Promise(function (resolve, reject) {
    var script = document.createElement('script');
    var prior = document.getElementsByTagName('script')[0];
    script.type = 'text/javascript';
    script.async = true;
    script.src = url;

    script.onload = script.onreadystatechange = function() {
      if (!script.readyState || /loaded|complete/.test(script.readyState)) {
        script.onload = script.onreadystatechange = null;
        script.onerror = script.onabort = null;
        resolve(script);
      }
    };
    script.onerror = script.onabort = function () {
      script.onload = script.onreadystatechange = null;
      script.onerror = script.onabort = null;
      reject(new Error('Failed to load ' + script.src));
    };

    prior.parentNode.insertBefore(script, prior);
  });
}
