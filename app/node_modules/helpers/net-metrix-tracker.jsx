import _ from 'lodash';

export default class NetMetrixTracker {
  constructor(options) {
    this.options = options;
  }

  getTag() {
    // remove undefined properties first
    let picked = _.pick(this.options.path, function(v) {
      return (v != null);
    });
    let path = _.values(picked).join('/');

    let referer = (document.referer ? `r=${encodeURIComponent(document.referer)}&` : ``);
    let queryString = `?${referer}d=${(new Date()).getTime()}&x=${this.options.screenWidth}x${this.options.screenHeight}`;

    let tag = `https://${this.options.domain}.wemfbox.ch/cgi-bin/ivw/CP/${path}${queryString}`;
    return tag;
  }

  track() {
    let image = new Image();
  
    // @TODO: activate tracking on live site only
    // image.src = this.getTag();

    return this.getTag();
  }

}
