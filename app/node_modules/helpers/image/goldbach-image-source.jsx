/*eslint-disable no-console */

import CryptoHMAC from 'crypto-js/hmac-sha1';
import CryptoBase64 from 'crypto-js/enc-base64';
import path from 'path';

const IMAGE_SALT = process.env.GOLDBACH_SALT || 'FyfgR5fadpR7S9w';

let base64Encode = function(str) {
  return str.replace(/\=$/, '').replace(/\+/g, '-').replace(/\//g, '_').replace(/\=+$/, '');
};

let createImageSignature = function(params) {
  let size = '/'.concat(params.width, 'x', params.height, (params.letterbox ? ',fill' : ''), (params.fill ? ',ar' : ''));
  let signature = CryptoHMAC(size, IMAGE_SALT);
  let encodedSignature = base64Encode(CryptoBase64.stringify(signature));
  return path.join(encodedSignature, size);
};

export default function(props) {
  return props.src + '/' + createImageSignature(props);
}

/*eslint-enable no-console */
