/* eslint-disable no-unused-expressions */

import _ from 'lodash';

import getImageProps from 'helpers/get-image-props';
import article from 'utils/data/master-article';

import { expect } from 'chai';

describe('Helpers', function() {

  describe('getImageProps', function() {

    let imageFixture, galleryFixture, videoFixture;

    beforeEach(function() {
      imageFixture = _.find(article.article.assets, function(chr) {
        return chr.asset.content_type === 'asset_image';
      });
      galleryFixture = _.find(article.article.assets, function(chr) {
        return chr.asset.content_type === 'asset_image_gallery';
      });
      videoFixture = _.find(article.article.assets, function(chr) {
        return chr.asset.content_type === 'asset_video';
      });
    });

    it('returns an object', function() {
      expect(getImageProps(imageFixture)).to.be.an('object');
    });

    it('object contains source, title and alt', function() {
      let result = getImageProps(imageFixture);
      expect(_.has(result, 'src')).to.be.true;
      expect(_.has(result, 'title')).to.be.true;
      expect(_.has(result, 'alt')).to.be.true;
    });

    it('returns asset alt as a fallback', function() {
      let clone = _.assign({}, imageFixture);
      let alt = clone.description;
      clone.description = null;
      clone.asset.description = alt;
      let result = getImageProps(clone);
      expect(result.alt).to.equal(alt);
    });

    it('returns title when there is no alt', function() {
      let clone = _.assign({}, imageFixture);
      clone.description = null;
      clone.asset.description = null;
      let result = getImageProps(clone);
      expect(result.alt).to.equal(clone.title.trim());
    });

    it('returns title when there is an alt', function() {
      let result = getImageProps(imageFixture);
      expect(result.title).to.contain(imageFixture.title.trim());
    });

    it('returns asset title as a fallback', function() {
      let clone = _.assign({}, imageFixture);
      let title = clone.title.trim();
      clone.title = null;
      clone.asset.title = title;
      let result = getImageProps(clone);
      expect(result.title).to.equal(title);
    });

    it('returns caption as title when there is no alt', function() {
      let clone = _.assign({}, imageFixture);
      clone.description = null;
      let result = getImageProps(clone);
      expect(result.title).to.contain('Â© ');
    });

    it('returns src for all types', function() {
      let imageResult = getImageProps(imageFixture);
      let galleryResult = getImageProps(galleryFixture);
      let videoResult = getImageProps(videoFixture);
      expect(_.has(imageResult, 'src')).to.be.true;
      expect(_.has(galleryResult, 'src')).to.be.true;
      expect(_.has(videoResult, 'src')).to.be.true;
    });

    it('returns asset src as a fallback for images', function() {
      let clone = _.assign({}, imageFixture);
      clone.image_url = null;
      let result = getImageProps(clone);
      expect(_.has(result, 'src')).to.be.true;
    });

    it('returns first image src for a gallery', function() {
      let firstImage = _.first(galleryFixture.asset.images);
      let result = getImageProps(galleryFixture);
      expect(result.src).to.equal(firstImage.image_url);
    });

  });

});
