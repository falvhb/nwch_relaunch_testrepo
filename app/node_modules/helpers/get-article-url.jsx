import slugify from 'slugify';
import _ from 'lodash';

export default function(article) {

  var ressorts = article.ressorts;
  var canonicalRessort = _.first(_.filter(ressorts, { 'ignore_for_canonical_url': false }));
  var mainRessort = canonicalRessort ? canonicalRessort : _.first(ressorts);

  // url format /<ressort>/<subressort>/<name>-<id>
  var paths = [];

  // <ressort>
  if (mainRessort.parent) {
    paths.push(mainRessort.parent.urlpart);
  }

  // <subressort>
  paths.push(mainRessort.urlpart);

  // <name>
  var name;
  if (article.manual_url) {
    name = article.manual_url;
  } else if (article.keyword_url && article.keywords) {
    name = slugify(article.keywords);
  } else {
    name = slugify(article.title);
  }

  // + -<id>
  paths.push(name + '-' + article.id);

  return '/' + paths.join('/');

}
