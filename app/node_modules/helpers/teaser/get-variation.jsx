import _ from 'lodash';

import getMainAsset from 'helpers/asset/get-main-asset';
import getImageProps from 'helpers/asset/get-image-props';
import getVariationConfig from './get-variation-config';
import getFallback from './get-fallback';

const switchedVariationsForLabelType = {
  basic: {
    meinung: 'quote'
  }
};

export default function(article, variation) {

  let labeltype = article.labeltype;

  let targetVariation = variation;

  // see if the variation needs to change depending on the labeltype
  if (labeltype) {
    let find = variation + '.' + labeltype;
    let newVariation = _.get(switchedVariationsForLabelType, find);
    if (newVariation) targetVariation = newVariation;
  }

  let mainAsset = getMainAsset(_.get(article, 'assets'));
  let variationConfig = getVariationConfig(targetVariation);
  let hasImage = _.get(variationConfig, 'image');

  let imageProps;
  if (mainAsset) imageProps = getImageProps(mainAsset);

  return hasImage && !imageProps
    ? getFallback(targetVariation)
    : targetVariation;
}
