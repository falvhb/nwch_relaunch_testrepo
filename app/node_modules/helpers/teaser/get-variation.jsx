import _ from 'lodash';

import getMainAsset from 'helpers/get-main-asset';
import getImageProps from 'helpers/get-image-props';
import getVariationConfig from './get-variation-config';
import getFallback from './get-fallback';

export default function(article, targetVariation) {
  let mainAsset = getMainAsset(_.get(article, 'assets'));
  let variationConfig = getVariationConfig(targetVariation);
  let hasImage = _.get(variationConfig, 'image');

  let imageProps;
  if (mainAsset) imageProps = getImageProps(mainAsset);

  return hasImage && !imageProps
    ? getFallback(targetVariation)
    : targetVariation;
}
