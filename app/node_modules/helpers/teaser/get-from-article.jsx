import _ from 'lodash';

import {
  getArticleTitle,
  getArticleUrl,
  getArticleImage,
  getArticleAuthorImage,
  getArticleMarker,
  getArticleSchema,
  getArticleTheme,
  getTeaserByline,
  getArticleSummary,
  getArticleCatchword
} from 'helpers/article';

import getTeaserVariation from './get-variation';

const switchedVariationsForLabelType = {
  basic: {
    meinung: 'quote'
  }
};

const avatarsForVariation = [
  'quote',
  'author'
];

export default function(data) {

  if (!data) {
    return false;
  }

  const { article, variation } = data;

  // test for changed variation of certain labeltypes
  let labelType = article.labeltype;
  let find = variation + '.' + labelType;
  let switchedVariation = _.get(switchedVariationsForLabelType, find);

  // set variation
  let teaserVariation = switchedVariation || variation;

  // see if we need an avatar
  let needsAvatar = _.includes(avatarsForVariation, teaserVariation);

  return {
    title: getArticleTitle(article),
    link: getArticleUrl(article),
    marker: getArticleMarker(article),
    schema: getArticleSchema(article),
    // props which change based on teaser variation
    catchword: getArticleCatchword(article, teaserVariation),
    variation: getTeaserVariation(article, teaserVariation),
    theme: getArticleTheme(article, teaserVariation),
    image: needsAvatar
      ? getArticleAuthorImage(article)
      : getArticleImage(article, teaserVariation),
    byline: getTeaserByline(article, teaserVariation),
    summary: getArticleSummary(article, teaserVariation)
  };
}
