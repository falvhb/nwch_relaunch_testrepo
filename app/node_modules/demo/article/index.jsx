/*eslint-disable no-shadow */
'use strict';

const React = require('react');
const _ = require('lodash');

const Article = React.createClass({

  getTeaserImageUrl: function() {
    /*
     * Dummy implementation of getting a teaser image URL.
     * Returns any sufficient image URL.
     *
     * Note: this is not the actual logic of how it's done in production.
     * Just for demonstration purposes.
     */
    var assets = this.props.assets;
    var isOfType = function(asset, contentType) {  // helper function
      return asset.asset && asset.asset.content_type === contentType;
    };
    var getImageUrlSafely = function(asset) {
      // check if the expected asset is present and return the URL.
      return asset &&
             asset.asset &&
             asset.asset.image_url;
    };

    // check if there is an image asset
    var imageAsset = _.find(assets, function(asset) {
      return isOfType(asset, 'asset_image');
    });
    if (imageAsset) {
      return getImageUrlSafely(imageAsset);
    }

    // No image asset, but maybe there is an image_gallery. If so, use the
    // first image from the gallery.
    var galleryAsset = _.find(assets, function(asset) {
      return isOfType(asset, 'asset_image_gallery');
    });
    // get the first image
    var asset = galleryAsset.asset &&
                galleryAsset.asset.images &&
                galleryAsset.asset.images[0];
    return getImageUrlSafely(asset);
  },

  render: function() {

    return (
      <article itemScope itemType='http://schema.org/Article'>
        <div className="teaser teaser-6col" style={{backgroundColor: '#fff4db'}}>
          <div className="teaserImageHolder asset_image">
            <img src={this.getTeaserImageUrl()} width="460" height="272" />
          </div>
          <div className="keyword">{this.props.context_label}</div>
          <div className="article-headline article-headline-h1">
            <a className="heading" href="#">{this.props.title}</a>
          </div>
          <div className="box anriss">{this.props.lead}</div>
          <div className="commentscount">
            <a className="related-link" href="#"> Kommentare<span> ({this.props.comment_count})</span></a>
          </div>
        </div>
      </article>
    );
  }

});

module.exports = Article;
