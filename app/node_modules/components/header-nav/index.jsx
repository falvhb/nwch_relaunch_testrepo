import React from 'react';
import _ from 'lodash';
import Icon from 'components/icon';

export default React.createClass({

  displayName: 'HeaderNav',

  propTypes: {
    isClosed: React.PropTypes.bool,
    id: React.PropTypes.number
  },

  getInitialState() {
    return {
      isHidden: true,
      isScrollNavHidden: true,
      isScrollSubNavHidden: true
    };
  },

  navItems: [
    {
      href: '/',
      label: 'Start'
    },
    {
      href: '/',
      label: 'Schweiz'
    },
    {
      href: '/',
      label: 'Ausland'
    },
    {
      href: '/',
      label: 'Wirtschaft'
    },
    {
      href: '/',
      label: 'Sport'
    },
    {
      href: '/',
      label: 'Panorama'
    },
    {
      href: '/',
      label: 'Kultur'
    },
    {
      href: '/',
      label: 'Blaulicht'
    }
  ],

  domainVariations: {
    aaz: {
      href: 'http://aargauerzeitung.ch/aargau',
      label: 'Aargau',
      logo: 'az_AargauerZeitung.svg',
      logoMobile: 'az_Mobile.svg'
    },
    bz: {
      href: 'http://bzbasel.ch/basel',
      label: 'Basel',
      logo: 'bz_Basel.svg',
      logoMobile: 'bz_Mobile.svg'
    },
    blz: {
      href: 'http://basellandschaftlichezeitung.ch/basel',
      label: 'Basel',
      logo: 'bz_Basellandschaftliche.svg',
      logoMobile: 'bz_Mobile.svg'
    },
    ot: {
      href: 'http://www.oltnertagblatt.ch/solothurn',
      label: 'Solothurn',
      logo: 'ot_OltnerTagblatt.svg',
      logoMobile: 'ot_Mobile.svg'
    },
    gtb: {
      href: 'http://grenchnertagblatt.ch/solothurn',
      label: 'Solothurn',
      logo: 'az_GrenchnerTagblatt.svg',
      logoMobile: 'az_Mobile.svg'
    },
    soz: {
      href: 'http://solothurnerzeitung.ch/solothurn',
      label: 'Solothurn',
      logo: 'az_SolothurnerZeitung.svg',
      logoMobile: 'az_Mobile.svg'
    },
    liz: {
      href: 'http://limmattalerzeitung.ch/limmattal',
      label: 'Limmattal',
      logo: 'az_LimmattalerZeitung.svg',
      logoMobile: 'az_Mobile.svg'
    },
    btb: {
      href: 'http://badenertagblatt.ch/aargau',
      label: 'Aargau',
      logo: 'az_BadenerTagblatt.svg',
      logoMobile: 'az_Mobile.svg'
    }
  },

  componentDidMount() {
    this.containerElement = document.createElement('div');
    this.containerElement.className = 'header-nav__scroll-navigation header-nav__scroll-navigation--hidden';
    document.body.appendChild(this.containerElement);
    this.renderScrollNavigation();
    this.scrollHandler = _.throttle(this.checkScrollPosition, 250);
    document.addEventListener('scroll', this.scrollHandler);
  },

  toggleNavigation() {
    this.setState({ isHidden: !this.state.isHidden });
  },

  checkScrollPosition() {
    if (window.scrollY > 150 && this.state.isScrollNavHidden) {
      this.toggleScrollNavigation();
    }
    if (window.scrollY <= 150 && ! this.state.isScrollNavHidden) {
      this.toggleScrollNavigation();
    }
  },

  toggleScrollNavigation() {
    var isScrollNavHidden = ! this.state.isScrollNavHidden;
    this.setState({ isScrollNavHidden });
    this.containerElement.className = isScrollNavHidden
      ? 'header-nav__scroll-navigation header-nav__scroll-navigation--hidden'
      : 'header-nav__scroll-navigation';
  },

  toggleScrollSubNavigation() {
    this.setState({ isScrollSubNavHidden: !this.state.isScrollSubNavHidden });
    setTimeout(() => this.renderScrollNavigation());
  },

  renderScrollNavigation() {
    const { skin } = this.props;
    const navItems = this.navItems.slice();

    if (skin in this.domainVariations) {
      navItems.splice(1, 0, {
        href: this.domainVariations[skin].href,
        label: this.domainVariations[skin].label
      });
    }

    var content = (
      <div>
        <div className="header-nav__scroll-main">
          <div className="header-nav__container">
            <a className="header-nav__scroll-logo" href="/" title="Startseite">
              <img src={"/__node__/__static__/client/images/logos/"+this.domainVariations[skin].logoMobile} />
            </a>
            <button onClick={this.toggleScrollSubNavigation} className="header-nav__scroll-menu-button">
              <img
                className={this.state.isScrollSubNavHidden
                  ? 'header-nav__scroll-menu-icon header-nav__scroll-menu-icon--menu'
                  : 'header-nav__scroll-menu-icon header-nav__scroll-menu-icon--close'
                }
                src={this.state.isScrollSubNavHidden
                  ? "/__node__/__static__/client/images/icons/menu.svg"
                  : "/__node__/__static__/client/images/icons/close.svg"
                } />
                <span>Menu</span>
            </button>
          </div>
        </div>
        <div className={"header-nav__scroll-links "+(this.state.isScrollSubNavHidden ? ' header-nav__scroll-links--hidden' : '')}>
          <nav className={"header-nav__container"+(this.state.isHidden ? ' header-nav--hidden' : '')}>
            <ul role='navigation'>
              <li>
                <a
                  href="/login"
                  className='header-nav__link header-nav__link--login'>
                  <img src="/__node__/__static__/client/images/user.svg" />
                  Login
                </a>
              </li>
              {navItems.map((navItem, index) =>
                <li key={index}>
                  <a
                    href={navItem.href}
                    className='header-nav__link'>
                    {navItem.label}
                  </a>
                </li>
              )}
            </ul>
          </nav>
        </div>
      </div>
    );

    React.render(content, this.containerElement);
  },

  render() {
    const { skin } = this.props;

    const navItems = this.navItems.slice();

    if (skin in this.domainVariations) {
      navItems.splice(1, 0, {
        href: this.domainVariations[skin].href,
        label: this.domainVariations[skin].label
      });
    }

    return (
      <nav className="header-nav">
        <div className="header-nav__brand">
          <div className="header-nav__container">
            <button onClick={this.toggleNavigation} className="header-nav__menu-button">
              <img
                className={this.state.isHidden
                  ? 'header-nav__menu-icon header-nav__menu-icon--menu'
                  : 'header-nav__menu-icon header-nav__menu-icon--close'
                }
                src={this.state.isHidden
                  ? "/__node__/__static__/client/images/icons/menu.svg"
                  : "/__node__/__static__/client/images/icons/close.svg"
                } />
            </button>
            <a href="/" title="Startseite">
              <img className="header-nav__logo header-nav__logo--notext" src={"/__node__/__static__/client/images/logos/"+this.domainVariations[skin].logoMobile} />
              <img className="header-nav__logo header-nav__logo--text" src={"/__node__/__static__/client/images/logos/"+this.domainVariations[skin].logo} />
            </a>
          </div>
        </div>
        <nav className={"header-nav__container"+(this.state.isHidden ? ' header-nav--hidden' : '')}>
          <ul role='navigation'>
            <li>
              <a
                href="/login"
                className='header-nav__link header-nav__link--login'>
                <Icon id="user"/>
                Login
              </a>
            </li>
            {navItems.map((navItem, index) =>
              <li key={index}>
                <a
                  href={navItem.href}
                  className='header-nav__link'>
                  {navItem.label}
                </a>
              </li>
            )}
          </ul>
        </nav>
      </nav>
    );
  }

});
