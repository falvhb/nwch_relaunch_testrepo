@import 'globals';
@import 'utilities/variables';

@keyframes responsive-image-loader {
  to {
    transform: rotate(1turn);
  }
}

/**
 * Responsive image
 */
.responsive-image {
  display: block;
  position: relative;
  overflow: hidden;

  /**
   * Padding-box hack to preserve ratio
   * See: http://andyshora.com/css-image-container-padding-hack.html
   */
  &::before {
    content: '';
    display: block;
  }

  /**
   * Responsive image loader
   * 1. Hidden
   */
  &::after {
    transition: opacity $image-transition;
    opacity: 0; /* 1 */
  }
}

/**
 * Responsive image while loading
 * 1. Absolute centering of the loader
 * 2. Displayed
 * 3. On top of content
 */
.responsive-image.is-loading {
  background: $light-grey;

  &::after {
    content: '';
    width: $image-loader-size;
    height: $image-loader-size;
    position: absolute; /* 1 */
    top: 50%; /* 1 */
    left: 50%; /* 1 */
    margin: -($image-loader-size / 2); /* 1 */
    opacity: 1; /* 2 */
    z-index: 1; /* 3 */
    border: 5px solid #b5b5b5;
    border-right-color: transparent;
    border-radius: 50%;
    animation: responsive-image-loader 1s linear infinite;
  }
}

/*
 * Responsive image when failed
 */
.responsive-image.is-failed {
  background: $light-grey;
}

@each $ratio in $image-ratios {
  $width: nth($ratio, 1);
  $height: nth($ratio, 2);

  /**
   * Padding-box hack to preserve ratio
   * See: http://andyshora.com/css-image-container-padding-hack.html
   */
  .responsive-image--#{$width}x#{$height}::before {
    padding-bottom: (($height / $width) * 100%);
  }
}

/**
 * Actual image element
 */
.responsive-image__img {
  position: absolute;
  z-index: 2;
  top: 0;
  left: 0;
  width: 100%;
  transition: opacity $image-transition;

  .is-loading &,
  .is-failed & {
    opacity: 0;
  }
}
