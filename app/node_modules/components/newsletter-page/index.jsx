import { each, defaults, capitalize } from 'lodash';
import React from 'react';
import bem from 'react-bem-helper';
import NewsletterForm from 'components/newsletter-form';
import SectionHeader from 'components/section-header';
import Checkbox from 'inputs/checkbox';
import TextInput from 'inputs/text';
import Button from 'components/button';
import regionData from 'config/newsletters.json';

const classes = new bem('newsletters');

export default React.createClass({

  displayName: 'NewsletterPage',

  getInitialState() {
    let regions = [];

    each(regionData, (towns, region) => each(towns, town =>
      regions.push(defaults({
        regionName: capitalize(region)
      }, town))
    ));

    return { regions };
  },

  renderFormField(field) {
    let { hidden, group, id, label, checked, regionName } = field;
    let fieldName = `group[${group}][${id}]`;
    let labelComponent = (
      <span>
        <strong>Newsletter {regionName}</strong>
        {' ' + label}
      </span>
    );

    if (!hidden) {
      return (
        <Checkbox
          className="form-checkbox-row"
          key= { fieldName }
          name={ fieldName }
          label={ labelComponent }
          value={id}
        />
      );
    } else if (checked) {
      return <input name={fieldName} key={fieldName} type="hidden" value={id} />;
    }

    return null;
  },

  render() {
    return (
      <div {...classes()}>
        <SectionHeader title="Newsletter" subtitle="Welchen Newsletter möchten Sie abonnieren?"/>

        <div {...classes('banner')}>
          <NewsletterForm {...classes('container')}>
            <fieldset>
              { this.state.regions.map(this.renderFormField) }
            </fieldset>

            <fieldset>
              <TextInput
                className="form-row"
                label="E-Mail"
                name="EMAIL"
                type="email"
              />

             <Checkbox
                className="form-row input__description"
                name="MERGE6"
                value="Ja"
                label='Ich bin damit einverstanden, dass mich die AZ Medien AG künftig per Email über weitere interessante Angebote informiert.'
              />
            </fieldset>

            <div className="form-row">
              <Button attributes={{ type: 'submit' }} label="Anmelden" modifier="primary"/>
            </div>
          </NewsletterForm>
        </div>
      </div>
    );
  }
});
