import React from 'react';
import _ from 'lodash';

import { getImageProps, getAssetMeta } from 'helpers';

export default Component =>  React.createClass({

  displayName: 'ImageAssetWrapper',

  propTypes: {
    asset: React.PropTypes.object.isRequired,
    size: React.PropTypes.string.isRequired,
    ratio: React.PropTypes.string.isRequired,
    defer: React.PropTypes.bool,
    letterbox: React.PropTypes.bool,
    lazyload: React.PropTypes.bool,
    itemProp: React.PropTypes.string
  },

  mappedData(props) {
    const {itemProp} = this.props;

    var microdata = {
      itemScope: true,
      itemType: 'http://schema.org/ImageObject'
    };

    if (itemProp) microdata.itemProp = itemProp;

    return {
      image: _.assign(getImageProps(props.asset), {
        size: props.size,
        ratio: props.ratio,
        defer: props.defer,
        letterbox: props.letterbox,
        lazyload: props.lazyload
      }),
      caption: getAssetMeta(props.asset),
      microdata: microdata
    };
  },

  render() {
    return (
      <Component {...this.mappedData(this.props)}/>
    );
  }

});
