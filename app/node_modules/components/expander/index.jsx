import React from 'react';
import BEM from 'react-bem-helper';

import ResponsiveVideoMixin from 'mixins/responsive-video';

const classes = new BEM({
  name: 'expander',
  prefix: ''
});

// For styleguide only
const ExpandableItem = React.createClass({
  render() {
    return (
      <div {...classes('placeholder')}>Expandable Item</div>
    );
  }
});

export default React.createClass({

  displayName: 'Expander',

  propTypes: {
    item: React.PropTypes.object,
    onAddExpanderHeight: React.PropTypes.func,
    initialHeight: React.PropTypes.number
  },

  getDefaultProps() {
    // set property when component rendered in style guide
    return {
      onAddExpanderHeight: function() {},
      height: 0
    };
  },

  getInitialState() {
    return {
      height: this.props.initialHeight
    };
  },

  componentDidMount() {
    this.setHeight();
  },

  getPlayerHeight(width) {
    // return the height of the video player
    return ResponsiveVideoMixin.getVideoHeight(16 / 9, width, 35.8);
  },

  addToHeight(itemHeight) {
    var expander,
        height;

    expander = React.findDOMNode(this.refs.expander);
    height = expander.firstChild.offsetHeight + itemHeight;
    expander.style.height = height + 'px';

    // calculate the height of the video
    playerHeight = ResponsiveVideoMixin.getVideoHeight(16 / 9, expander.offsetWidth, 35.8);

    // calculate the height of the video library viewer
    height = Math.round(expander.firstChild.offsetHeight + playerHeight);

    // do not directly set style attributes. Instead use a state and set style in render method.
    this.setState({
      height: height
    });

    // notify expandable to take into account the new height of the expander
    this.props.onAddExpanderHeight(height);
  },

  render() {
    var item;

    if (this.props.item) {
      item = this.props.item;
    } else {
      item = <ExpandableItem />;
    }

    return (

      <div {...classes(null, null)}>
        <div {...classes(null, 'inner')} ref={'expander'} style={{height: this.state.height + 'px'}}>
          {item}
        </div>
      </div>
    );
  }

});
