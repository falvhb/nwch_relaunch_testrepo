/* eslint-disable no-unused-expressions, no-unused-vars */
/* global expect:true, assert:true */
import React from 'react/addons';
const TestUtils = React.addons.TestUtils;
import { expect, assert, should } from 'chai';

import Expandable from 'components/expandable';
import data from 'components/expandable/.variations.json';

describe('Expandable', () => {
  var reactElement,
    component,
    props;

  describe('renders', () => {
    var Child,
        children;

    beforeEach(() => {
      props = data[0].data;

      Child = 'div';
      children = <Child id="childA" className="childA">child A</Child>;

      reactElement = (
        <Expandable {...props}>
          {children}
        </Expandable>
      );
      component = TestUtils.renderIntoDocument(reactElement);
    });

    it('a DOM Component with a BEM class', () => {
      var componentWithClass = TestUtils.findRenderedDOMComponentWithClass(component, 'expandable');
      expect(TestUtils.isDOMComponent(componentWithClass)).to.be.true;
    });

    it('a child', () => {
      var childInstance = TestUtils.findRenderedDOMComponentWithClass(component, 'childA');
      expect(TestUtils.isDOMComponent(childInstance)).to.be.true;
    });

  });

  describe('height calculations in collpased state', () => {
    var Child,
        children,
        expandableInstance;

    beforeEach(() => {
      props = data[0].data;
      props.expanded = false;

      Child = 'div';
      children = <Child id="childA" className="childA">child A</Child>;

      reactElement = (
        <Expandable {...props}>
          {children}
        </Expandable>
      );
      component = TestUtils.renderIntoDocument(reactElement);

      expandableInstance = TestUtils.scryRenderedComponentsWithType(component, Expandable)[0];
    });

    it('can reset its height', () => {
      expandableInstance.getDOMNode().style.height = '11px';
      expandableInstance.resetHeight();
      expect(expandableInstance.getDOMNode().style.height).to.equal('');
    });

    it('can not have its height updated', () => {
      var additionalHeight = 100;
      var targetHeight = props.expandableHeight + additionalHeight + 'px';
      var childInstance = TestUtils.findRenderedDOMComponentWithClass(component, 'childA');

      // set height of expandable by triggering child
      childInstance.props.onSetExpandableHeight(100);

      expect(expandableInstance.getDOMNode().style.height).to.equal('');
    });
  });

  describe('height calculations in expanded state', () => {
    var Child,
        children,
        expandableInstance;

    beforeEach(() => {
      props = data[0].data;
      props.expanded = true;

      Child = 'div';
      children = <Child id="childA" className="childA">child A</Child>;

      reactElement = (
        <Expandable {...props}>
          {children}
        </Expandable>
      );
      component = TestUtils.renderIntoDocument(reactElement);

      expandableInstance = TestUtils.scryRenderedComponentsWithType(component, Expandable)[0];
    });

    it('can not reset its height', () => {
      expandableInstance.getDOMNode().style.height = '11px';
      expandableInstance.resetHeight();
      expect(expandableInstance.getDOMNode().style.height).to.equal('11px');
    });

    it('can have its height updated by its child', () => {
      var additionalHeight = 100;
      var targetHeight = props.expandableHeight + additionalHeight + 'px';
      var childInstance = TestUtils.findRenderedDOMComponentWithClass(component, 'childA');

      // set height of expandable by triggering child
      childInstance.props.onSetExpandableHeight(100);

      expect(expandableInstance.getDOMNode().style.height).to.equal(targetHeight);
    });

    it('can have its height set even when no height is given', () => {
      var targetHeight = '260px';
      var childInstance = TestUtils.findRenderedDOMComponentWithClass(component, 'childA');

      // set height without specifying an argument
      childInstance.props.onSetExpandableHeight();

      expect(expandableInstance.getDOMNode().style.height).to.equal(targetHeight);
    });
  });

});
