import React from 'react';
import BEM from 'react-bem-helper';
import _ from 'lodash';
// import axios from 'axios';

import SectionHeader from 'components/section-header';
import Container from 'components/container';
import WeatherForecast from 'components/weather-forecast';

const classes = new BEM('weather-detail');

export default React.createClass({

  displayName: 'WeatherDetail',

  propTypes: {
    cities: React.PropTypes.array.isRequired,
    forecast: React.PropTypes.object.isRequired,
    forecastDays: React.PropTypes.object.isRequired,
    city: React.PropTypes.string.isRequired,
    onSelectCity: React.PropTypes.func
  },

  selectCity(event) {
    let city = event.target.value;
    this.props.onSelectCity(city);
  },

  getCityByName(name) {
    let cities = this.props.cities;
    let result = _.find(cities, function(city) {
      return city.name === name;
    });
    return result;
  },

  renderForecast() {
    var forecastDays = this.props.forecastDays.days[0] || {};
    var { SymbAft, TempMor, TempAft } = forecastDays;
    var { prog } = this.props.forecastDays.forecast;

    return (

      <div {...classes()}>
        <div  {...classes('forecast')}>
          <WeatherForecast
            id={SymbAft}
            minTemperature={TempMor}
            maxTemperature={TempAft}
          />
        </div>
        <div {...classes('text')}>
          {prog}
        </div>
      </div>
    );
  },

  render() {

    // @TODO: make sure code works when this.props.cities is not there
    let cities = this.props.cities || [];

    let options = cities.map((item, index) => {
      return <option value={item.id} key={index}>{item.name}</option>;
    });

    // let selectedCity = this.getCityByName(this.props.city || this.props.cities[0].name);
    // console.log("is there a city?", this.props.city);
    let forecast = this.renderForecast();

    return (
      <Container>
        <SectionHeader title='Gemeinde Ã¤ndern:' />
        <div {...classes('dropdown')}>
          <select
            {...classes('select')}
            onChange={this.selectCity}
            value={this.props.id}
          >
            {options}
          </select>
        </div>
        {forecast}
      </Container>
    );
  }
});
