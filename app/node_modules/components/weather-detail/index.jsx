import React from 'react';
import BEM from 'react-bem-helper';
import _ from 'lodash';
import Section from 'components/section';
import SectionHeader from 'components/section-header';
import Container from 'components/container';
import WeatherForecast from 'components/weather-forecast';

const classes = new BEM('weather-detail');

export default React.createClass({

  displayName: 'WeatherDetail',

  propTypes: {
    parishes: React.PropTypes.array.isRequired
  },

  getInitialState() {
    return this.state = {
      // @TODO: make sure code works when this.props.parishes[0].name is not there
      // Hack to make it temporarily work while integrating into page
      // styleguide only: this.props.parishes[0].name
      parish: ''
    };
  },

  onSelectParish(event) {
    var parish = event.target.value;
    this.selectParish(parish);
  },

  selectParish(parish) {
    this.setState({parish: parish});
  },

  getParishByName(name) {
    let parishes = this.props.parishes;
    let result = _.find(parishes, function(parish) {
      return parish.name === name;
    });

    return result;
  },

  renderForecast(parish) {

    if (!parish) {
      return '';
    }

    return (
      <div {...classes()}>
        <div  {...classes('forecast')}>
          <WeatherForecast
            id={parish.weatherIcon}
            minTemperature={parish.minTemperature}
            maxTemperature={parish.maxTemperature}
          />
        </div>
        <div {...classes('text')}>
          {parish.weatherText}
        </div>
      </div>
    );
  },

  render() {

    // @TODO: make sure code works when this.props.parishes is not there
    let parishes = this.props.parishes || [];

    let options = parishes.map((item, index) => {
      return <option value={item.name} key={index}>{item.name}</option>;
    });

    let selectedParish = this.getParishByName(this.state.parish);
    let forecast = this.renderForecast(selectedParish);

    return (
      <Section modifier='default'>
        <Container>
          <SectionHeader title='Gemeinde Ã¤ndern:' />
          <div {...classes('dropdown')}>
            <select
              {...classes('select')}
              onChange={this.onSelectParish}
              value={this.state.parish}
            >
              {options}
            </select>
          </div>
          {forecast}
        </Container>
      </Section>
    );
  }
});
