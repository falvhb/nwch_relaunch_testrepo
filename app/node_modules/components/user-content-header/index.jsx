import React from 'react';
import bem from 'react-bem-helper';
import Icon from 'components/icon';
import { capitalize } from 'lodash/string';

const classes = new bem('ugc-header');

export default React.createClass({

  displayName: 'UGCHeader',

  propTypes: {
    ugc: React.PropTypes.shape({
      type: React.PropTypes.oneOf(['leserbeitrag', 'vereinsmeldung', 'sportverein', 'gemeindebeitrag']).isRequired,
      city: React.PropTypes.shape({
        name: React.PropTypes.string.isRequired,
        url: React.PropTypes.string.isRequired,
        shield_url: React.PropTypes.string
      }),
      author: React.PropTypes.shape({
        name: React.PropTypes.string.isRequired,
        url: React.PropTypes.string.isRequired,
        image: React.PropTypes.string
      })
    }),
    sponsor: React.PropTypes.shape({
      title: React.PropTypes.string.isRequired,
      url: React.PropTypes.string.isRequired,
      text: React.PropTypes.string,
      image: React.PropTypes.string
    })
  },

  nameForType(type) {
    return capitalize({
      sportverein: 'sportvereinsmeldung',
      sponsor: this.props.sponsor.text || 'Pr√§sentiert von'
    }[type] || type) + ' ';
  },

  renderSponsor() {
    var { title, image, url } = this.props.sponsor;

    return (
      <span key='sponsor' {...classes('block')} itemProp="author">
        <a href={url} {...classes('text')}>
          <span {...classes('link')} itemProp="name"> { title }</span>
        </a>
        <img itemProp="logo" src={ image } alt="" {...classes('avatar', 'sponsor')} />
      </span>
    )
  },

  renderCity() {
    var { name, image, url } = this.props.ugc.city;

    return (
      <span key='city' {...classes('block')} itemProp="contentLocation">
        <a href={url}>
          <span {...classes('text')} >
            { 'aus ' }
            <span {...classes('link')} itemProp="name"> { name }</span>
          </span>
          <img itemProp="logo" src={ image } alt="" {...classes('avatar', 'city')} />
        </a>
      </span>
    )
  },

  renderClub() {
    var { name, image, url } = this.props.ugc.club;
    return (
      <span key='club' {...classes('block')} itemProp="subject">
        <a href={url}>
          <span {...classes('text')} >
            <span {...classes('link')} itemProp="name"> { name }</span>
          </span>
          <img itemProp="image" src={ image } alt="" {...classes('avatar', 'author')} />
        </a>
      </span>
    )
  },

  renderAuthor() {
    var { name, image, url } = this.props.ugc.author;

    return (
      <span key='author' {...classes('block')} itemProp="author">
        <a href={url}>
          <span {...classes('text')} >
            { 'von ' }
            <span {...classes('link')} itemProp="name"> { name }</span>
          </span>
          <img itemProp="image" src={ image } alt="" {...classes('avatar', 'author')} />
        </a>
      </span>
    )
  },

  render() {
    var { ugc, sponsor } = this.props;
    var type = sponsor ? 'sponsor' : ugc && ugc.type;

    // Making an array of elements to be displayed
    var items = [
      this.nameForType(type)
    ];

    // Start with the megaphone icon when it's not a sponsor
    if (!sponsor) {
      items.unshift(
        <Icon {...classes('icon')} key='icon' id='megaphone' />
      );
    }

    switch (type) {
      case 'sponsor':
        items.push(this.renderSponsor());
        break;
      case 'leserbeitrag':
        items.push(this.renderAuthor(), this.renderCity())
        break;
      case 'gemeindebeitrag':
        items.push(this.renderCity(), this.renderAuthor())
        break;
      case 'vereinsmeldung':
      case 'sportverein':
        items.push(this.renderClub(), this.renderAuthor())
        break;
    }

    return (
      <div {...classes(null, type, 'type-detail')}>
        { items }
      </div>
    );
  }
});
