const React = require('react');
const ReactToJsx = require('react-to-jsx');
const Highlight = require('react-highlight');
const bem = require('react-bem-helper');

const Tabs = require('styleguide/tabs');
const IFrame = require('styleguide/iframe');
const Loading = require('styleguide/loading');

const classes = new bem({
  name: 'viewer',
  prefix: 'styleguide-'
});

const Viewer = React.createClass({

  propTypes: {
    component: React.PropTypes.object.isRequired,
    variation: React.PropTypes.object,
    children: React.PropTypes.element.isRequired
  },

  removeTabs(markup) {
    return markup.replace(/\t/g, '  ');
  },

  render() {

    var props = this.props;

    var sections = [
      {
        title: 'Preview',
        content: <IFrame {...props} />
      },
      {
        title: 'JSX',
        content: <Loading key='jsx'><Highlight className='html'>{this.removeTabs(ReactToJsx(props.children))}</Highlight></Loading>
      },
      {
        title: 'HTML',
        content: <Loading key='html'><Highlight className='html'>{React.renderToStaticMarkup(props.children)}</Highlight></Loading>
      },
      {
        title: 'Data',
        content: props.json
          ? <Loading key='data'><Highlight className='json'>{JSON.stringify(props.json, null, 2)}</Highlight></Loading>
          : <p>You should add sample data to <code>{props.variation ? '.variations.json' : '.data.json'}</code> in the root of this component!</p>
      }
    ];

    return (
      <div {...classes()}>
        <Tabs sections={sections} />
      </div>
    );

  }

});

module.exports = Viewer;
