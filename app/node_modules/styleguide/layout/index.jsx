import React from 'react';
import slugify from 'slugify';

import Main from 'styleguide/main';
import Sidebar from 'styleguide/sidebar';
import Intro from 'styleguide/intro';
import Component from 'styleguide/component';

import HtmlClasses from 'clientside/html-support-classes';

export default React.createClass({

  displayName: 'Layout',

  // These are passed from server.js/browser.js
  propTypes: {
    components: React.PropTypes.array.isRequired,
    component: React.PropTypes.object,
    children: React.PropTypes.element
  },

  getInitialState() {
    return {
      component: this.props.component
    };
  },

  componentDidMount() {
    let htmlClasses = new(HtmlClasses);
    htmlClasses.init();
  },

  render() {
    var variation, component = this.state.component;
    if (component && component.variations) {
      variation = component.variations[component.variationIndex];
      variation.slug = slugify(variation.title).toLowerCase();
    }

    var mainContent = <Intro/>;
    if (component) {
      mainContent = (
        <Component component={component} variation={variation}>
          {this.props.children}
        </Component>
      );
    }

    return (
      <div className='styleguide'>
        <Sidebar components={this.props.components} active={(component ? component.slug : '')} />
        <Main components={this.props.components} active={(component ? component.slug : '')}>
          {mainContent}
        </Main>
      </div>
    );
  }

});
