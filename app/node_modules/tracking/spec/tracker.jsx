/* eslint-disable no-console, no-unused-vars, no-unused-expressions, no-shadow */
/* global chai:true */
import Test from 'legit-tests/no-dom';
import { expect, assert, should } from 'chai';
import sinon from 'sinon';
import sinonChai from 'sinon-chai';
chai.should();
chai.use(sinonChai);

import Tracker from 'tracking/tracker';
import NetMetrixTracker from 'tracking/net-metrix-tracker';
// import GoogleAnalyticsTracker from 'tracking/google-analytics-tracker';

import QS from 'qs';
import _ from 'lodash';


describe('Tracker\'s method', () => {
  var output,
      data,
      nmMethod,
      nmSpy,
      gaMethod,
      gaSpy,
      image;

  beforeEach(() => {
    data = {
      domain: 'aznetz',
      path: {
        event: 'pageview',
        view: 'page',
        sitename: 'soz',
        path: '/schweiz/baden/mein-artikel-66666666?param=see%20..#anchor_name',
        dummy: 'dummy',
        product: 'live',
        id: '1234',
        paging: 3,
        dummy2: null
      },
      referer: 'http://www.google.com'
    };

    nmMethod = NetMetrixTracker.trackPageView;
    // gaMethod = GoogleAnalytics.trackPageView;
    nmSpy = sinon.spy(NetMetrixTracker, 'trackPageView');
    // gaSpy = sinon.spy(GoogleAnalyticsTracker, 'trackPageView');
  });

  afterEach(() => {
    nmSpy.reset();
    // gaSpy.reset();

    NetMetrixTracker.trackPageView = nmMethod;
    // GoogleAnalytics.trackPageView = gaMethod;
  });

  //
  // Public methods
  //
  describe('trackPageView', () => {
    it('fires valid pageview tracking for Net Metrix(@TODO, Google Analytics and Chartbeat)', () => {

      Tracker.trackPageView(data);
      image = document.getElementById('netMetrixPageViewTracker');
      nmSpy.should.have.been.calledWithExactly(data);
      nmSpy.should.have.been.calledOnce;
      expect(image.src).to.match(new RegExp('^https://aznetz.wemfbox.ch/cgi-bin/ivw/CP/live/soz/schweiz/page/pageview'));

      // gaSpy.should.have.been.calledWithExactly(data);
    });

    it('fires valid pageview tracking even when given no data', () => {

      Tracker.trackPageView();
      image = document.getElementById('netMetrixPageViewTracker');
      nmSpy.should.have.been.calledWithExactly(undefined);
      nmSpy.should.have.been.calledOnce;
      expect(image.src).to.match(new RegExp('^https://aznetz.wemfbox.ch/cgi-bin/ivw/CP/'));

      // gaSpy.should.have.been.calledWithExactly(undefined);
    });

    it('fires valid pageview tracking when given null as input', () => {

      Tracker.trackPageView(null);
      image = document.getElementById('netMetrixPageViewTracker');
      nmSpy.should.have.been.calledWithExactly(null);
      nmSpy.should.have.been.calledOnce;
      expect(image.src).to.match(new RegExp('^https://aznetz.wemfbox.ch/cgi-bin/ivw/CP/'));

      // gaSpy.should.have.been.calledWithExactly(null);
    });

    it('fires valid pageview tracking when given empty object as input', () => {
      Tracker.trackPageView({});
      image = document.getElementById('netMetrixPageViewTracker');
      nmSpy.should.have.been.calledWithExactly({});
      nmSpy.should.have.been.calledOnce;
      expect(image.src).to.match(new RegExp('^https://aznetz.wemfbox.ch/cgi-bin/ivw/CP/'));

      // gaSpy.should.have.been.calledWithExactly({});
    });

    it('fires valid pageview tracking when given empty array as input', () => {

      Tracker.trackPageView([]);
      image = document.getElementById('netMetrixPageViewTracker');
      nmSpy.should.have.been.calledWithExactly([]);
      nmSpy.should.have.been.calledOnce;
      expect(image.src).to.match(new RegExp('^https://aznetz.wemfbox.ch/cgi-bin/ivw/CP/'));

      // gaSpy.should.have.been.calledWithExactly([]);
    });

  });

});
