import { pick } from 'lodash/object';
import axios from 'axios';

const LOGIN_URL = '/__api/v1/login';

// Place for translating
function translateMessage(message) {
  return {
    unknown: 'Something went wrong but we don\'t know what'
  }[message.toLowerCase()] || message;
};

const unknownError = {
  errorMessage: translateMessage('unknown'),
  submitting: false
}

export default {
  login(data, callback) {
    var fieldsToPost = pick(data, ['email', 'password']);

    axios.post(LOGIN_URL, fieldsToPost).then(function(response) {
      var data = response.data;
      console.log(response);
      if (data.error) {
        callback({
          errorMessage: translateMessage(data.error),
          submitting: false
        })
      } else if (data.status === "ok") {
        callback({
          authenticated: true,
          submitting: false
        })
      } else {
        callback(unknownError);
      }
    }).catch(function() {
      callback(unknownError);
    });
  }
}
