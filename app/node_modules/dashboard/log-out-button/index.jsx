import React from 'react';
import bem from 'react-bem-helper';
import AuthenticationAPI from 'dashboard/authentication/api';
import { History } from 'react-router';

const classes = new bem('logout-button');

export default React.createClass({
  displayName: 'LogoutButton',

  mixins: [History],

  getInitialState: () => ({
    busy: false
  }),

  onLogoutClick() {
    this.setState({
      busy: true
    }, () => AuthenticationAPI.logout(this.onLogoutComplete));
  },

  onLogoutComplete(result) {
    this.setState({
      busy: false
    });

    if (result) {
      document.location.reload();
    }
  },

  render() {
    return (
      <button
        {...classes({ extra: 'button button--meta' })}
        disabled={ this.state.busy }
        onClick={ this.onLogoutClick }
      >
         Abmelden
      </button>
    );
  }

});
